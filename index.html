<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>FotoPDF ‚Äì Fotoƒüraf & PDF</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --bg: #0f0f13;
            --surface: #18181f;
            --surface2: #22222d;
            --accent: #f0c040;
            --accent2: #e87c3e;
            --text: #f0eee8;
            --muted: #7a7a8a;
            --danger: #e05252;
            --radius: 14px;
            --transition: 0.22s cubic-bezier(.4,0,.2,1);
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 24px;
            background: var(--surface);
            border-bottom: 1px solid #2a2a38;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo {
            font-family: 'Syne', sans-serif;
            font-weight: 800;
            font-size: 1.3rem;
            letter-spacing: -0.5px;
        }
        .logo span { color: var(--accent); }
        .photo-count {
            background: var(--surface2);
            border: 1px solid #2a2a38;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 0.82rem;
            color: var(--muted);
        }
        .photo-count b { color: var(--accent); font-weight: 700; }

        /* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
        main { flex: 1; padding: 20px 16px 100px; max-width: 860px; margin: 0 auto; width: 100%; }

        /* ‚îÄ‚îÄ Settings Bar ‚îÄ‚îÄ */
        .settings-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }
        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
            min-width: 130px;
        }
        .setting-group label {
            font-size: 0.72rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            font-weight: 500;
        }
        select, input[type="range"] {
            background: var(--surface2);
            border: 1px solid #2a2a38;
            color: var(--text);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.88rem;
            font-family: inherit;
            cursor: pointer;
            width: 100%;
            outline: none;
            transition: border var(--transition);
        }
        select:focus { border-color: var(--accent); }
        input[type="range"] { padding: 10px 12px; accent-color: var(--accent); }
        .quality-value { font-size: 0.82rem; color: var(--accent); font-weight: 700; }

        /* ‚îÄ‚îÄ Drop Zone ‚îÄ‚îÄ */
        .drop-zone {
            border: 2px dashed #2e2e3e;
            border-radius: var(--radius);
            padding: 40px 20px;
            text-align: center;
            background: var(--surface);
            cursor: pointer;
            transition: border var(--transition), background var(--transition);
            margin-bottom: 18px;
            position: relative;
        }
        .drop-zone:hover, .drop-zone.drag-over {
            border-color: var(--accent);
            background: rgba(240,192,64,0.04);
        }
        .drop-zone input { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
        .drop-icon { font-size: 2.4rem; margin-bottom: 10px; }
        .drop-zone h3 { font-family: 'Syne', sans-serif; font-size: 1rem; margin-bottom: 5px; }
        .drop-zone p { font-size: 0.82rem; color: var(--muted); }

        /* ‚îÄ‚îÄ Photo Grid ‚îÄ‚îÄ */
        #photo-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .photo-item {
            position: relative;
            border-radius: 10px;
            overflow: visible;
            cursor: grab;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity:0; transform:scale(.9); } to { opacity:1; transform:scale(1); } }
        .photo-item:active { cursor: grabbing; }

        .photo-item img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: 10px;
            display: block;
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
            transition: transform var(--transition);
        }
        .photo-item:hover img { transform: scale(1.02); }

        .photo-item .index-badge {
            position: absolute;
            bottom: 6px;
            left: 6px;
            background: rgba(0,0,0,0.7);
            color: #fff;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 2px 7px;
            border-radius: 999px;
            pointer-events: none;
            backdrop-filter: blur(4px);
        }

        .remove-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            border: 2px solid var(--bg);
            border-radius: 50%;
            width: 26px;
            height: 26px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            transition: transform var(--transition);
            z-index: 2;
        }
        .remove-btn:hover { transform: scale(1.15); }

        /* Sortable ghost */
        .sortable-ghost { opacity: 0.3; }
        .sortable-chosen { transform: scale(1.05); box-shadow: 0 8px 30px rgba(0,0,0,0.5); }

        /* ‚îÄ‚îÄ Bottom Action Bar ‚îÄ‚îÄ */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            border-top: 1px solid #2a2a38;
            padding: 14px 16px;
            display: flex;
            gap: 10px;
            justify-content: center;
            z-index: 100;
        }
        .btn {
            padding: 13px 26px;
            border: none;
            border-radius: 10px;
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            transition: transform var(--transition), opacity var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn:hover { opacity: 0.88; transform: translateY(-1px); }
        .btn:active { transform: translateY(0); }
        .btn-select { background: var(--surface2); color: var(--text); border: 1px solid #2e2e3e; position: relative; overflow: hidden; }
        .btn-select input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
        .btn-pdf {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: #111;
            flex: 1;
            max-width: 280px;
            justify-content: center;
        }
        .btn-pdf:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

        /* ‚îÄ‚îÄ Progress ‚îÄ‚îÄ */
        .progress-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(10,10,16,0.85);
            backdrop-filter: blur(6px);
            z-index: 200;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 16px;
        }
        .progress-overlay.active { display: flex; }
        .progress-box {
            background: var(--surface);
            border: 1px solid #2a2a38;
            border-radius: 16px;
            padding: 30px 36px;
            text-align: center;
            min-width: 260px;
        }
        .progress-box h3 { font-family: 'Syne', sans-serif; margin-bottom: 14px; }
        .progress-bar-wrap {
            width: 100%;
            height: 8px;
            background: var(--surface2);
            border-radius: 999px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            border-radius: 999px;
            transition: width 0.25s ease;
            width: 0%;
        }
        .progress-label { font-size: 0.82rem; color: var(--muted); }

        /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: var(--surface2);
            border: 1px solid #2e2e3e;
            color: var(--text);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.88rem;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            pointer-events: none;
            white-space: nowrap;
            z-index: 300;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* Empty state */
        .empty-state {
            grid-column: 1/-1;
            text-align: center;
            padding: 40px 20px;
            color: var(--muted);
            font-size: 0.9rem;
        }

        @media (max-width: 480px) {
            #photo-list { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
            .photo-item img { height: 100px; }
            .settings-bar { flex-direction: column; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<!-- Header -->
<header>
    <div class="logo">Foto<span>PDF</span></div>
    <div class="photo-count" id="countBadge">Fotoƒüraf: <b>0</b></div>
</header>

<!-- Main -->
<main>
    <!-- Settings -->
    <div class="settings-bar">
        <div class="setting-group">
            <label>Sayfa Boyutu</label>
            <select id="pageSize">
                <option value="a4">A4</option>
                <option value="a5">A5</option>
                <option value="letter">Letter</option>
                <option value="square">Kare (15√ó15cm)</option>
            </select>
        </div>
        <div class="setting-group">
            <label>Yerle≈üim</label>
            <select id="layoutMode">
                <option value="auto">Otomatik (Y√∂n Algƒ±la)</option>
                <option value="portrait">Hep Dikey</option>
                <option value="landscape">Hep Yatay</option>
            </select>
        </div>
        <div class="setting-group">
            <label>Kalite: <span class="quality-value" id="qualityLabel">85%</span></label>
            <input type="range" id="qualityRange" min="40" max="100" value="85">
        </div>
    </div>

    <!-- Drop Zone -->
    <div class="drop-zone" id="dropZone">
        <input type="file" id="imageInput" multiple accept="image/*">
        <div class="drop-icon">üì∑</div>
        <h3>Fotoƒüraf Ekle</h3>
        <p>Tƒ±kla veya s√ºr√ºkleyip bƒ±rak ‚Ä¢ JPG, PNG, WebP</p>
    </div>

    <!-- Photo Grid -->
    <div id="photo-list">
        <div class="empty-state" id="emptyState">
            Hen√ºz fotoƒüraf yok.<br>Yukarƒ±dan se√ßerek ba≈ülayƒ±n.
        </div>
    </div>
</main>

<!-- Bottom Action Bar -->
<div class="action-bar">
    <button class="btn btn-select">
        <span>üìÅ</span> Fotoƒüraf Se√ß
        <input type="file" id="imageInput2" multiple accept="image/*">
    </button>
    <button class="btn btn-pdf" id="generatePdfBtn" disabled>
        <span>üìÑ</span> PDF ƒ∞ndir
    </button>
</div>

<!-- Progress Overlay -->
<div class="progress-overlay" id="progressOverlay">
    <div class="progress-box">
        <h3>PDF Olu≈üturuluyor‚Ä¶</h3>
        <div class="progress-bar-wrap">
            <div class="progress-bar-fill" id="progressFill"></div>
        </div>
        <div class="progress-label" id="progressLabel">0 / 0 fotoƒüraf</div>
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
    const { jsPDF } = window.jspdf;
    const photoList = document.getElementById('photo-list');
    const generatePdfBtn = document.getElementById('generatePdfBtn');
    const progressOverlay = document.getElementById('progressOverlay');
    const progressFill = document.getElementById('progressFill');
    const progressLabel = document.getElementById('progressLabel');
    const countBadge = document.getElementById('countBadge');
    const emptyState = document.getElementById('emptyState');
    const qualityRange = document.getElementById('qualityRange');
    const qualityLabel = document.getElementById('qualityLabel');
    const dropZone = document.getElementById('dropZone');
    const toastEl = document.getElementById('toast');

    // ‚îÄ‚îÄ Sortable ‚îÄ‚îÄ
    new Sortable(photoList, {
        animation: 200,
        ghostClass: 'sortable-ghost',
        chosenClass: 'sortable-chosen',
        filter: '.remove-btn,.empty-state',
        onEnd: updateBadges
    });

    // ‚îÄ‚îÄ Quality slider ‚îÄ‚îÄ
    qualityRange.addEventListener('input', () => {
        qualityLabel.textContent = qualityRange.value + '%';
    });

    // ‚îÄ‚îÄ File inputs ‚îÄ‚îÄ
    [document.getElementById('imageInput'), document.getElementById('imageInput2')]
        .forEach(input => input.addEventListener('change', e => loadFiles(e.target.files)));

    // ‚îÄ‚îÄ Drag & Drop on zone ‚îÄ‚îÄ
    dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
    dropZone.addEventListener('drop', e => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        loadFiles(e.dataTransfer.files);
    });

    // ‚îÄ‚îÄ Load Files ‚îÄ‚îÄ
    function loadFiles(files) {
        const imageFiles = Array.from(files).filter(f => f.type.startsWith('image/'));
        if (imageFiles.length === 0) return;

        imageFiles.forEach(file => {
            const reader = new FileReader();
            reader.onload = e => addPhotoItem(e.target.result, file.type);
            reader.readAsDataURL(file);
        });

        // Clear inputs
        document.getElementById('imageInput').value = '';
        document.getElementById('imageInput2').value = '';
    }

    function addPhotoItem(src, mimeType) {
        if (emptyState) emptyState.style.display = 'none';

        const div = document.createElement('div');
        div.className = 'photo-item';
        div.dataset.mime = mimeType || 'image/jpeg';

        const img = document.createElement('img');
        img.src = src;
        img.loading = 'lazy';

        const badge = document.createElement('div');
        badge.className = 'index-badge';

        const btn = document.createElement('button');
        btn.className = 'remove-btn';
        btn.innerHTML = '√ó';
        btn.onclick = () => {
            div.remove();
            updateBadges();
            updateState();
        };

        div.appendChild(img);
        div.appendChild(badge);
        div.appendChild(btn);
        photoList.appendChild(div);

        updateBadges();
        updateState();
    }

    function updateBadges() {
        photoList.querySelectorAll('.photo-item .index-badge').forEach((b, i) => {
            b.textContent = i + 1;
        });
    }

    function updateState() {
        const count = photoList.querySelectorAll('.photo-item').length;
        countBadge.innerHTML = `Fotoƒüraf: <b>${count}</b>`;
        generatePdfBtn.disabled = count === 0;
        if (count === 0 && emptyState) emptyState.style.display = '';
    }

    // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
    function showToast(msg, duration = 2500) {
        toastEl.textContent = msg;
        toastEl.classList.add('show');
        setTimeout(() => toastEl.classList.remove('show'), duration);
    }

    // ‚îÄ‚îÄ Page size map ‚îÄ‚îÄ
    const PAGE_SIZES = {
        a4:     { w: 210, h: 297 },
        a5:     { w: 148, h: 210 },
        letter: { w: 215.9, h: 279.4 },
        square: { w: 150, h: 150 }
    };

    // ‚îÄ‚îÄ Get image format for jsPDF ‚îÄ‚îÄ
    function getFormat(mime) {
        if (mime.includes('png')) return 'PNG';
        if (mime.includes('webp')) return 'WEBP';
        return 'JPEG';
    }

    // ‚îÄ‚îÄ PDF Generation ‚îÄ‚îÄ
    generatePdfBtn.addEventListener('click', async () => {
        const items = Array.from(photoList.querySelectorAll('.photo-item'));
        if (items.length === 0) return;

        const pageSizeKey = document.getElementById('pageSize').value;
        const layoutMode = document.getElementById('layoutMode').value;
        const quality = parseInt(qualityRange.value) / 100;
        const pageSize = PAGE_SIZES[pageSizeKey];
        const margin = 8; // mm
        const UNIT = 'mm';

        // Show progress
        progressOverlay.classList.add('active');
        generatePdfBtn.disabled = true;

        let doc = null;

        for (let i = 0; i < items.length; i++) {
            const img = items[i].querySelector('img');
            const imgData = img.src;
            const mime = items[i].dataset.mime || 'image/jpeg';
            const fmt = getFormat(mime);

            // Determine orientation
            const naturalW = img.naturalWidth;
            const naturalH = img.naturalHeight;
            let orientation = 'portrait';
            if (layoutMode === 'landscape') orientation = 'landscape';
            else if (layoutMode === 'auto' && naturalW > naturalH) orientation = 'landscape';

            const pw = orientation === 'landscape' ? pageSize.h : pageSize.w;
            const ph = orientation === 'landscape' ? pageSize.w : pageSize.h;

            if (i === 0) {
                doc = new jsPDF({ orientation, unit: UNIT, format: [pw, ph] });
            } else {
                doc.addPage([pw, ph], orientation);
            }

            // Scale image to fit with margin
            const maxW = pw - margin * 2;
            const maxH = ph - margin * 2;
            const imgRatio = naturalW / naturalH;
            let drawW = maxW;
            let drawH = drawW / imgRatio;
            if (drawH > maxH) { drawH = maxH; drawW = drawH * imgRatio; }
            const x = (pw - drawW) / 2;
            const y = (ph - drawH) / 2;

            // Convert to canvas for quality control
            const canvas = document.createElement('canvas');
            canvas.width = naturalW;
            canvas.height = naturalH;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);
            const outFmt = fmt === 'PNG' ? 'PNG' : 'JPEG';
            const outData = outFmt === 'JPEG' ? canvas.toDataURL('image/jpeg', quality) : canvas.toDataURL('image/png');

            doc.addImage(outData, outFmt, x, y, drawW, drawH);

            // Update progress
            const pct = Math.round(((i + 1) / items.length) * 100);
            progressFill.style.width = pct + '%';
            progressLabel.textContent = `${i + 1} / ${items.length} fotoƒüraf`;

            // Small delay so UI can update
            await new Promise(r => setTimeout(r, 30));
        }

        doc.save(`fotopdf-${Date.now()}.pdf`);
        progressOverlay.classList.remove('active');
        generatePdfBtn.disabled = false;
        showToast('‚úÖ PDF ba≈üarƒ±yla indirildi!');
    });
</script>
</body>
</html>
